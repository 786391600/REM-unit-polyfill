/**
 * Module: rem - v1.2.2
 * Description: A polyfill to parse CSS links and rewrite pixel equivalents into head for non supporting browsers
 * Date Built: 2014-04-05
 * Copyright (c) 2014  | Chuck Carpenter <chuck.carpenter@me.com>,Lucas Serven <lserven@gmail.com>;
**/
(function(window,undefined){var cssremunit=function(){var div=document.createElement("div");div.style.cssText="font-size: 1rem;";return/rem/.test(div.style.fontSize)},isStyleSheet=function(){var styles=document.getElementsByTagName("link"),filteredLinks=[];for(var i=0;i<styles.length;i++)if(styles[i].rel.toLowerCase()==="stylesheet"&&styles[i].getAttribute("data-norem")===null)filteredLinks.push(styles[i].href);return filteredLinks},processLinks=function(){if(links.length===0)links=isStyleSheet();for(var i=0;i<links.length;i++)xhr(links[i],storeCSS,links[i],i)},storeCSS=function(response,link){preCSS.push(response.responseText);CSSLinks.push(link);if(CSSLinks.length===links.length){for(var j=0;j<CSSLinks.length;j++)matchCSS(preCSS[j],CSSLinks[j]);if((links=importLinks.slice(0)).length>0){CSSLinks=[];preCSS=[];importLinks=[];processLinks()}else buildCSS()}},matchCSS=function(sheetCSS,link){var clean=removeComments(removeMediaQueries(sheetCSS)),pattern=/[\w\d\s\-\/\\\[\]:,.'"*()<>+~%#^$_=|@]+\{[\w\d\s\-\/\\%#:!;,.'"*()]+\d*\.?\d+rem[\w\d\s\-\/\\%#:!;,.'"*()]*\}/g,current=clean.match(pattern),remPattern=/\d*\.?\d+rem/g,remCurrent=clean.match(remPattern),sheetPathPattern=/(.*\/)/,sheetPath=sheetPathPattern.exec(link)[0],importPattern=/@import (?:url\()?['"]?([^'\)"]*)['"]?\)?[^;]*/gm,importStatement;while((importStatement=importPattern.exec(sheetCSS))!==null)importLinks.push(sheetPath+importStatement[1]);if(current!==null&&current.length!==0){found=found.concat(current);foundProps=foundProps.concat(remCurrent)}},buildCSS=function(){var pattern=/[\w\d\s\-\/\\%#:,.'"*()]+\d*\.?\d+rem[\w\d\s\-\/\\%#:!,.'"*()]*[;}]/g;for(var i=0;i<found.length;i++){rules=rules+found[i].substr(0,found[i].indexOf("{")+1);var current=found[i].match(pattern);for(var j=0;j<current.length;j++){rules=rules+current[j];if(j===current.length-1&&rules[rules.length-1]!=="}")rules=rules+"\n}"}}parseCSS()},parseCSS=function(){for(var i=0;i<foundProps.length;i++)css[i]=Math.round(parseFloat(foundProps[i].substr(0,foundProps[i].length-3)*fontSize))+"px";loadCSS()},loadCSS=function(){for(var i=0;i<css.length;i++)if(css[i])rules=rules.replace(foundProps[i],css[i]);var remcss=document.createElement("style");remcss.setAttribute("type","text/css");remcss.id="remReplace";document.getElementsByTagName("head")[0].appendChild(remcss);if(remcss.styleSheet)remcss.styleSheet.cssText=rules;else remcss.appendChild(document.createTextNode(rules))},xhr=function(url,callback,i){try{var xhr=getXMLHttpRequest(),isOldIE=document.all;xhr.open("GET",url,true);xhr.send(null);if(!isOldIE||isOldIE&&window.XMLHttpRequest)xhr.onreadystatechange=function(){if(xhr.readyState===4)callback(xhr,i)};else xhr.onreadystatechange=new function(){if(xhr.readyState===4)callback(xhr,i)}}catch(e){if(window.XDomainRequest){var xdr=new XDomainRequest;xdr.open("get",url);xdr.onload=function(){callback(xdr,i)};xdr.onerror=function(){return false};xdr.send()}}},removeComments=function(css){var start=css.search(/\/\*/),end=css.search(/\*\//);while(start>-1&&end>start){css=css.substring(0,start)+css.substring(end+2);start=css.search(/\/\*/);end=css.search(/\*\//)}return css},mediaQuery=function(){if(window.matchMedia||window.msMatchMedia)return true;return false},removeMediaQueries=function(css){if(!mediaQuery())css=css.replace(/@media[\s\S]*?\}\s*\}/g,"");return css},getXMLHttpRequest=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;else try{return new ActiveXObject("MSXML2.XMLHTTP")}catch(e1){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e2){}}};if(!cssremunit()){var rules="",links=[],importLinks=[],found=[],foundProps=[],preCSS=[],CSSLinks=[],css=[],fontSize="";fontSize=function(){var doc=document,docElement=doc.documentElement,body=doc.body||doc.createElement("body"),isFakeBody=!doc.body,div=doc.createElement("div"),currentSize=body.style.fontSize,size;if(isFakeBody)docElement.appendChild(body);div.style.cssText="width:1em; position:absolute; visibility:hidden; padding: 0;";body.style.fontSize="1em";body.appendChild(div);size=div.offsetWidth;if(isFakeBody)docElement.removeChild(body);else{body.removeChild(div);body.style.fontSize=currentSize}return size}();processLinks()}})(window);
